---
title: 'New in Opera Presto 2.2: TLS 1.2 Support'
authors:
- yngve-pettersen
tags:
- tls
- ssl
- presto
- opera
- encryption
- presto
- protocols
- webstandards
- coreblog
layout: post
---
One of the new, but less obvious, features in Opera Presto 2.2 and Opera 10 is support for version 1.2 of the Transport Layer Security (TLS) protocol, the protocol formerly known as SSL.<br/> <br/>TLS 1.2 was released as <a href="http://www.ietf.org/rfc/rfc5246.txt" target="_blank">RFC 5246</a> last August, replacing TLS 1.1 (<a href="http://www.ietf.org/rfc/rfc4346.txt" target="_blank">RFC 4346</a>).<br/> <br/><strong>What is new in TLS 1.2?</strong><br/> <br/>This version of the protocol has several new features:<br/> <br/><ul class="bullets"><li> The way calculation of encryption keys is performed is made more dynamic, and new ciphersuites (set of encryption methods used by a connection) can define their own method, rather than having only the default one. This was necessary because some suites, such as a russian one, could not be used with the default method.</li><li> The default digest method is now SHA-256, offering stronger security.</li><li> Several new cipher suites (using existing encryption methods) also use SHA-256.</li><li> It has better ways to negotiate what signature algorithms the client supports.</li></ul><br/> <br/>Using SHA-256 as the digest method means we are using a more secure method for all the important calculations, and it removes TLS&#39;s dependency on MD5. While MD5 is used in a fashion that should reduce the impact of, if not eliminate, the problems the MD5 method is <a href="http://my.opera.com/securitygroup/blog/2009/01/30/md5-in-certificates-what-is-happening" target="_blank">now encountering</a>, the fact that the method is crumbling is, at best, problematic for TLS 1.1 and TLS 1.0.<br/> <br/>Additionally, the document now includes the TLS extensions specification. This means that developers no longer need two documents to get all details about the formats used for these.<br/><br/>The document also added an implementor&#39;s checklist, making it easier for developers to catch mistakes early. This was added in part due to Opera&#39;s <a href="http://my.opera.com/yngve/blog/show.dml/319177" target="_blank">findings</a> about the lack of interoperability between many clients and servers, often due to server-side implementation errors.<br/> <br/>There are currently few, if any, production servers using TLS 1.2, which is to be expected for a new protocol version, but there are a couple of test servers available.<br/> <br/><strong>What is new in Opera relating to TLS?</strong><br/> <br/>Adapting Opera&#39;s TLS stack to support TLS 1.2 required some significant changes, mostly caused by the new flexibility in the key calculation.<br/> <br/>The TLS feature testing, which determines the highest version of TLS supported by the server, was also slightly modified, and it will now always require TLS Extensions for TLS 1.1 and higher. We will also, in future upgrades, assume that any server supporting TLS 1.1 or higher will not panic if the client offers a protocol version newer than it supports, and will, in the future, test TLS 1.0, TLS 1.0+extenstion, TLS 1.1<br/>(w/extenstion) and then the highest TLS version we support. A few years down the road we may also remove this cumbersome method, and offer our highest version in the first connection.<br/> <br/>These changes resulted in a redesign with so many deep changes that the dormant support for SSL v2 was removed completely from the source code. Although the binary formats of TLS 1.2 and SSL v2 are incompatible, it is possible for them to co-exist, but the cost of making sure the inactive code actually <i>worked</i> would be too high. SSL v2 has been disabled by default in Opera since v8.0, and the actual functionality was disabled completely in 9.5. It would just not be economical to make sure this protocol version still works, along with the associated internal structure changes, when we have no intention of reactivating the code again. Instead, it was much easier to just &quot;tear out&quot; the code.<br/><br/><strong>Testing</strong><br/><br/>If you want to test TLS 1.2, Michael D&#39;Errico, who&#39;s developing his own TLS toolkit, has graciously agreed to let you test against his server at <a href="https://www.mikestoolbox.net/" target="_blank">https://www.mikestoolbox.net/</a>. This server is using two private Root Certificates, <a href="http://files.myopera.com/yngve/blog/MikesToolbox2.pem" target="_blank">&lt;1&gt;</a> and <a href="http://files.myopera.com/yngve/blog/MikesToolbox.pem" target="_blank">&lt;2&gt;</a> which you may want to import into your test configuration (it may be necessary to reload after a negotiation error once if you don&#39;t install it). When importing the certificates, after saving them to disk, you must remember to click &quot;View&quot; to go to the details dialog, and uncheck the &quot;Warn about&quot; checkbox, before completing the installation. When connecting to Michael&#39;s server you should get a page that includes these two lines:<br/><br/><blockquote class="bbquote"><p><br/>TLS version:     1.2<br/>Cipher suite:    TLS_DHE_RSA_WITH_AES_256_CBC_SHA256 (006B)<br/></p></blockquote><br/><br/>Mike was quite helpful while we were debugging our implementation and helped clear up several mistakes. We also use his server in our automatic regression tests, and we thank him for the assistance.<br/><br/><a class="attach" href="http://files.myopera.com/yngve/blog/MikesToolbox.pem" target="_blank">First Root Certificate for Mikes Toolbox</a><br/><a class="attach" href="http://files.myopera.com/yngve/blog/MikesToolbox2.pem" target="_blank">Second Root Certificate for Mikes Toolbox (needed in 10.0)</a>
